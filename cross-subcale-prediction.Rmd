---
title: "LP2-Cross-Subscale-Prediction"
author: ""
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    df_print: paged
    highlight: tango
    theme: united
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
  github_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE)
options(scipen=999)
```



```{r load packages and installize conda environment, include=FALSE}
if (!require("pacman")) install.packages("pacman") #run this if you don't have pacman 
library(pacman)
setwd("~/Box Sync/CurrentProjects_Penn/LP2/within_person_intervention/data/models")

pacman::p_load(tidyverse,rlang, plotrix, ggpubr, caret, broom, kableExtra, reactable, knitr, DT, stringr,ggwordcloud, install = T) 
# Set-up an environment with text-required python packages
```

```{r eval=FALSE, include=FALSE}
library(text)
textrpp_install()
textrpp_initialize()

```

```{r load-data}
df <- read_csv("/Users/stevenmesquiti/Box Sync/CurrentProjects_Penn/LP2/within_person_intervention/data/surveys_scored/LP2_transcriptions_behavioral.csv")
embeddings <- read_rds("/Users/stevenmesquiti/Box Sync/CurrentProjects_Penn/LP2/within_person_intervention/data/embeddings/all_embeddings.rds")
```


```{r define functions}
calculate_and_store_rmse <- function(column_name, model_names, actual_values, predicted_values) {
  results_list <- list()
  
  for (col_name in model_names) {
    if (grepl(column_name, col_name)) {
      rmse_value <- Metrics::rmse(actual_values[[column_name]], predicted_values[[col_name]])
      results_list <- c(results_list, list(data.frame(Model = col_name, RMSE = rmse_value)))
    }
  }
  
  return(results_list)
}

results <- list()

# List of column names to include in the loop
selected_columns <- c(
  "pre_PWB_autonomy", 
  "pre_PWB_environmental_mastery", 
  "pre_PWB_mean",
  "pre_PWB_personal_growth",
  "pre_PWB_positive_relations",
  "pre_PWB_purpose",
  "pre_PWB_self_acceptance",
  "pre_SWLS_mean"
)
table <- function(correlation_data) {
  # Convert the character columns to factors for better rendering
  correlation_data$descriptions <- gsub("^Q[0-9]+\\.\\.(.+?)\\.\\.Transcription", "\\1", correlation_data$descriptions)
  correlation_data$descriptions <- gsub("(\\d)_([A-Za-z])", "\\1~\\2", correlation_data$descriptions)

  correlation_data$descriptions <- as.factor(correlation_data$descriptions)
  correlation_data$alternative <- as.factor(correlation_data$alternative)
  # Round the numeric columns to three decimal places
  correlation_data$correlation <- round(as.numeric(correlation_data$correlation), 3)
  correlation_data$t_statistics <- round(as.numeric(correlation_data$t_statistics), 3)
  correlation_data$p_value <- sapply(correlation_data$p_value, function(p) {
    ifelse(as.numeric(p) < 0.001, "< .001", 
           ifelse(as.numeric(p) == 1, "1.000", 
                  gsub("0.(.*)", ".\\1", sprintf("%.3f", as.numeric(p)))))
  })
  correlation_data$p_value_corrected <- round(as.numeric(correlation_data$p_value_corrected), 3)

  # Create the DataTable
  datatable(correlation_data, extensions = 'FixedColumns', 
            filter = list(position = 'top', clear = FALSE),
            options = list(search = list(regex = TRUE, caseInsensitive = FALSE), pageLength = 25))
}


rmse_table <- function(correlation_data) {
  # Convert the character columns to factors for better rendering
  correlation_data$Model <- gsub("^Q[0-9]+\\.\\.(.+?)\\.\\.Transcription", "\\1", correlation_data$Model)
  correlation_data$Model <- gsub("(\\d)_([A-Za-z])", "\\1~\\2", correlation_data$Model)

  correlation_data$Model <- as.factor(correlation_data$Model)
  # Round the numeric columns to three decimal places
  correlation_data$RMSE <- round(as.numeric(correlation_data$RMSE), 3)

  # Create the DataTable
  datatable(correlation_data, extensions = 'FixedColumns', 
            filter = list(position = 'top', clear = FALSE),
            options = list(search = list(regex = TRUE, caseInsensitive = FALSE), pageLength = 25))
}

```

```{r}
plot_aes = theme_minimal() +
  theme(legend.position = "right",
        legend.text = element_text(size = 8),
        text = element_text(size = 12, family = "Futura Medium"),
        axis.text = element_text(color = "black"),
        axis.ticks.y = element_blank())
```

# Prompts and Corresponding Qualtrics Questions {.tabset}

## Positive Affect

*Prompts*

> Positive Affect 1. Describe a recent time when you felt calm or at ease.

> Positive Affect 2. Describe a recent time when you felt joyful or excited.

> Positive Affect 3. Describe a recent time when you felt interested.

## Purpose

*Prompts*

> Purpose 1. When you think about your life, what are you striving to accomplish?

> Purpose 2. What kind of plans do you have for the future and how are you working towards them?

> Purpose 3. Do you feel like you have a sense of direction in your life, or do you feel like you're wandering aimlessly?

*Qualtrics Questions*

> Purpose 1 Some people wander aimlessly through life, but I am not one of them

> Purpose 2 I live life one day at a time and don't really think about the future

> Purpose 3 I sometimes feel as if I've done all there is to do in life

## Relationships

*Prompts*

> Relationships 1. Describe the level of trust between you and your friends.

> Relationships 2. Describe a conversation you had recently with a family member or friends that you enjoyed.

> Relationships 3. Describe a time when you were willing to generously share your time with someone else.

*Qualtrics Questions*

> Relationships 1 Maintaining close relationships has been difficult and frustrating for me

> Relationships 2 People would describe me as a giving person, willing to share my time with others

> Relationships 3 People would describe me as a giving person, willing to share my time with others

## Self-acceptance

*Prompts*

> Self-Acceptance 1. What aspect or aspects of your personality do you like?

> Self-Acceptance 2. When you look back at the story of your life, what are you pleased about?

> Self-Acceptance 3. What life achievements are you proud of?

*Qualtrics Questions*

> Self-Acceptance 1 I like most parts of my personality

> Self-Acceptance 2 When I look at the story of my life, I am pleased with how things have turned out so far

> Self-Acceptance 3 In many ways I feel disappointed about my achievements in life

## Personal Growth

*Prompts*

> Personal Growth 1. What experiences have you had that challenged how you think about yourself and the world?

> Personal Growth 2. How have you developed as a person over time?

> Personal Growth 3. Describe a situation that prompted you to change your old familiar ways of doing things.

*Qualtrics Questions*

> Personal Growth 1 For me, life has been a continuous process of learning, changing, and growth

> Personal Growth 2 I think it is important to have new experiences that challenge how I think about myself and the world

> Personal Growth 3 I gave up trying to make big improvements or changes in my life a long time ago

## Autonomy

*Prompts*

> Autonomy 1. In what ways do you judge yourself by what you think is important and/or what others think is important?

> Autonomy 2. In what ways do you worry about what other people think of you? NOT FEATURED

> Autonomy 3. In what ways are your decisions influenced (or not) by what others are doing?

> Autonomy 4. Describe a time when you chose to voice (or not voice) your own opinion on a controversial matter.

*Qualtrics Questions*

> Autonomy 1 I tend to be influenced by people with strong opinions

> Autonomy 2 I have confidence in my own opinions, even if they are different from the way most other people think

> Autonomy 3 I judge myself by what I think is important, not by the values of what others think is important

# construct models {.tabset}

## Positive Affect {.tabset}

### Estimates

```{r}
if (!file.exists("affect_cross_output.RDS")) {
  affect_cross <- textTrainLists(
    x = embeddings$texts[7:9],
    y = df[11:18],
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "positive affect predicting pre-subscales and WB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(affect_cross, "affect_cross_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  affect_cross <- readRDS("affect_cross_output.RDS")
}
table(affect_cross$results)
```

### RMSE

```{r}
affect_cross_predictions <-as.data.frame(affect_cross$predictions[1:24])


models <- c(colnames(affect_cross$predictions[1:24]))


# Loop over selected columns
for (column_name in selected_columns) {
  # Calculate RMSE and store results
  result <- calculate_and_store_rmse(
    column_name = column_name,
    model_names = models,
    actual_values = df,
    predicted_values = affect_cross_predictions
  )
  
  # Append the result to the results list
  results <- c(results, result)
  
  # Convert the results list to a data frame
results_df <- do.call(rbind, results) %>%
  distinct() %>% 
  filter(grepl("affect_[0-9]+", Model, ignore.case = TRUE))
}

rmse_table(results_df)

```

### Heatmaps

```{r}
affect_df <- affect_cross$results

affect_df$prompt <- str_extract(affect_df$descriptions, "\\.\\.([^\\.]+)\\.")
affect_df$subscale <- str_extract(affect_df$descriptions, "pre_(.+$)")

# Remove the original "descriptions" column
affect_df <- affect_df %>% 
  select(-descriptions)

affect_df$correlation <- as.numeric(affect_df$correlation)

# Define the custom color scale

ggplot(affect_df, aes(x = prompt, y = subscale, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(correlation, 3)), color = "black", size = 4) +
  scale_fill_gradient2(low = "#c44536",
                       mid = "#FFFFCC",
                       high = "dodgerblue") +
    geom_text(data = subset(affect_df, p_value < 0.05), aes(label = "*", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
    geom_text(data = subset(affect_df, p_value < 0.01), aes(label = "**", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
geom_text(data = subset(affect_df, p_value < 0.001), aes(label = "***", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
  plot_aes
```

## Purpose {.tabset}

### Estimates

```{r}
if (!file.exists("purpose_cross_output.RDS")) {
 purpose_cross <- textTrainLists(
    x = embeddings$texts[10:12],
    y = df[11:18],
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "purpose predicting pre-subscales and WB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(purpose_cross, "purpose_cross_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  purpose_cross <- readRDS("purpose_cross_output.RDS")
}
table(purpose_cross$results)
```

### RMSE

```{r}
purpose_cross_predictions <-as.data.frame(purpose_cross$predictions[1:24])
models <- c(colnames(purpose_cross$predictions[1:24]))

# Loop over selected columns
for (column_name in selected_columns) {
  # Calculate RMSE and store results
  result <- calculate_and_store_rmse(
    column_name = column_name,
    model_names = models,
    actual_values = df,
    predicted_values = purpose_cross_predictions
  )
  
  # Append the result to the results list
  results <- c(results, result)
  
  # Convert the results list to a data frame
results_df <- do.call(rbind, results) %>%
  distinct() %>% 
  filter(grepl("purpose_[0-9]+", Model, ignore.case = TRUE))
}

rmse_table(results_df)
```

### Heatmaps

```{r}
purpose_df <- purpose_cross$results

purpose_df$prompt <- str_extract(purpose_df$descriptions, "\\.\\.([^\\.]+)\\.")
purpose_df$subscale <- str_extract(purpose_df$descriptions, "pre_(.+$)")

# Remove the original "descriptions" column
purpose_df <- purpose_df %>% 
  select(-descriptions)

purpose_df$correlation <- as.numeric(purpose_df$correlation)

# Define the custom color scale

ggplot(purpose_df, aes(x = prompt, y = subscale, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(correlation, 3)), color = "black", size = 4) +
  scale_fill_gradient2(low = "#c44536",
                       mid = "#FFFFCC",
                       high = "dodgerblue") +
    geom_text(data = subset(purpose_df, p_value < 0.05), aes(label = "*", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
    geom_text(data = subset(purpose_df, p_value < 0.01), aes(label = "**", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
geom_text(data = subset(purpose_df, p_value < 0.001), aes(label = "***", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
  plot_aes
```

## Relationships {.tabset}

### Estimates 

```{r}
if (!file.exists("relationships_cross_output.RDS")) {
 relationships_cross <- textTrainLists(
    x = embeddings$texts[13:15],
    y = df[11:18],
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "relationships predicting pre-subscales and WB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(relationships_cross, "relationships_cross_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  relationships_cross <- readRDS("relationships_cross_output.RDS")
}
table(relationships_cross$results)
```

### RMSE

```{r}
relationships_cross_predictions <-as.data.frame(relationships_cross$predictions[1:24])
models <- c(colnames(relationships_cross$predictions[1:24]))

# Loop over selected columns
for (column_name in selected_columns) {
  # Calculate RMSE and store results
  result <- calculate_and_store_rmse(
    column_name = column_name,
    model_names = models,
    actual_values = df,
    predicted_values = relationships_cross_predictions
  )
  
  # Append the result to the results list
  results <- c(results, result)
  
  # Convert the results list to a data frame
results_df <- do.call(rbind, results) %>%
  distinct() %>% 
  filter(grepl("relationships_[0-9]+", Model, ignore.case = TRUE))
}

rmse_table(results_df)
```

### Heatmaps

```{r}
relationships_df <- relationships_cross$results

relationships_df$prompt <- str_extract(relationships_df$descriptions, "\\.\\.([^\\.]+)\\.")
relationships_df$subscale <- str_extract(relationships_df$descriptions, "pre_(.+$)")

# Remove the original "descriptions" column
relationships_df <- relationships_df %>% 
  select(-descriptions)

relationships_df$correlation <- as.numeric(relationships_df$correlation)

# Define the custom color scale

ggplot(relationships_df, aes(x = prompt, y = subscale, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(correlation, 3)), color = "black", size = 4) +
  scale_fill_gradient2(low = "#c44536",
                       mid = "#FFFFCC",
                       high = "dodgerblue") +
    geom_text(data = subset(relationships_df, p_value < 0.05), aes(label = "*", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
    geom_text(data = subset(relationships_df, p_value < 0.01), aes(label = "**", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
geom_text(data = subset(relationships_df, p_value < 0.001), aes(label = "***", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
  plot_aes
```

## Self-Acceptance {.tabset}

### Estimates

```{r}
if (!file.exists("acceptance_cross_output.RDS")) {
 acceptance_cross <- textTrainLists(
    x = embeddings$texts[16:18],
    y = df[11:18],
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "acceptance predicting pre-subscales and WB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(acceptance_cross, "acceptance_cross_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  acceptance_cross <- readRDS("acceptance_cross_output.RDS")
}
table(acceptance_cross$results)
```

### RMSE

```{r}
acceptance_cross_predictions <-as.data.frame(acceptance_cross$predictions[1:24])
models <- c(colnames(acceptance_cross$predictions[1:24]))

# Loop over selected columns
for (column_name in selected_columns) {
  # Calculate RMSE and store results
  result <- calculate_and_store_rmse(
    column_name = column_name,
    model_names = models,
    actual_values = df,
    predicted_values = acceptance_cross_predictions
  )
  
  # Append the result to the results list
  results <- c(results, result)
  
  # Convert the results list to a data frame
results_df <- do.call(rbind, results) %>%
  distinct() %>% 
  filter(grepl("acceptance_[0-9]+", Model, ignore.case = TRUE))
}

rmse_table(results_df)
```

### Heatmaps

```{r}
acceptance_df <- acceptance_cross$results

acceptance_df$prompt <- str_extract(acceptance_df$descriptions, "\\.\\.([^\\.]+)\\.")
acceptance_df$subscale <- str_extract(acceptance_df$descriptions, "pre_(.+$)")

# Remove the original "descriptions" column
acceptance_df <- acceptance_df %>% 
  select(-descriptions)

acceptance_df$correlation <- as.numeric(acceptance_df$correlation)

# Define the custom color scale

ggplot(acceptance_df, aes(x = prompt, y = subscale, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(correlation, 3)), color = "black", size = 4) +
  scale_fill_gradient2(low = "#c44536",
                       mid = "#FFFFCC",
                       high = "dodgerblue") +
    geom_text(data = subset(acceptance_df, p_value < 0.05), aes(label = "*", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
    geom_text(data = subset(acceptance_df, p_value < 0.01), aes(label = "**", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
geom_text(data = subset(acceptance_df, p_value < 0.001), aes(label = "***", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
  plot_aes
```

## Personal Growth {.tabset}

### Estimates

```{r}
if (!file.exists("growth_cross_output.RDS")) {
 growth_cross <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df[11:18],
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "personal growth predicting pre-subscales and WB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(growth_cross, "growth_cross_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  growth_cross <- readRDS("growth_cross_output.RDS")
}
table(growth_cross$results)
```

### RMSE

```{r}
growth_cross_predictions <-as.data.frame(growth_cross$predictions[1:24])
models <- c(colnames(growth_cross$predictions[1:24]))

# Loop over selected columns
for (column_name in selected_columns) {
  # Calculate RMSE and store results
  result <- calculate_and_store_rmse(
    column_name = column_name,
    model_names = models,
    actual_values = df,
    predicted_values = growth_cross_predictions
  )
  
  # Append the result to the results list
  results <- c(results, result)
  
  # Convert the results list to a data frame
results_df <- do.call(rbind, results) %>%
  distinct() %>% 
   filter(grepl("growth_[0-9]+", Model, ignore.case = TRUE))
}

rmse_table(results_df)

```

### Heatmaps

```{r}
growth_df <- growth_cross$results

growth_df$prompt <- str_extract(growth_df$descriptions, "\\.\\.([^\\.]+)\\.")
growth_df$subscale <- str_extract(growth_df$descriptions, "pre_(.+$)")

# Remove the original "descriptions" column
growth_df <- growth_df %>% 
  select(-descriptions)

growth_df$correlation <- as.numeric(growth_df$correlation)

# Define the custom color scale

ggplot(growth_df, aes(x = prompt, y = subscale, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(correlation, 3)), color = "black", size = 4) +
  scale_fill_gradient2(low = "#c44536",
                       mid = "#FFFFCC",
                       high = "dodgerblue") +
    geom_text(data = subset(growth_df, p_value < 0.05), aes(label = "*", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
    geom_text(data = subset(growth_df, p_value < 0.01), aes(label = "**", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
geom_text(data = subset(growth_df, p_value < 0.001), aes(label = "***", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
  plot_aes
```

## Autonomy {.tabset}

### Estimates

```{r}
if (!file.exists("autonomy_cross_output.RDS")) {
 autonomy_cross <- textTrainLists(
    x = embeddings$texts[1:3],
    y = df[11:18],
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "autonomy predicting pre-subscales and WB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(autonomy_cross, "autonomy_cross_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  autonomy_cross <- readRDS("autonomy_cross_output.RDS")
}
table(autonomy_cross$results)
```

### RMSE

```{r}
autonomy_cross_predictions <-as.data.frame(autonomy_cross$predictions[1:24])
models <- c(colnames(autonomy_cross$predictions[1:24]))

# Loop over selected columns
for (column_name in selected_columns) {
  # Calculate RMSE and store results
  result <- calculate_and_store_rmse(
    column_name = column_name,
    model_names = models,
    actual_values = df,
    predicted_values = autonomy_cross_predictions
  )
  
  # Append the result to the results list
  results <- c(results, result)
  
  # Convert the results list to a data frame
results_df <- do.call(rbind, results) %>%
  distinct() %>% 
  filter(grepl("autonomy_[0-9]+", Model, ignore.case = TRUE))
}

rmse_table(results_df)

```

### Heatmaps

```{r}
autonomy_df <- autonomy_cross$results

autonomy_df$prompt <- str_extract(autonomy_df$descriptions, "\\.\\.([^\\.]+)\\.")
autonomy_df$subscale <- str_extract(autonomy_df$descriptions, "pre_(.+$)")

# Remove the original "descriptions" column
autonomy_df <- autonomy_df %>% 
  select(-descriptions)

autonomy_df$correlation <- as.numeric(autonomy_df$correlation)

# Define the custom color scale

ggplot(autonomy_df, aes(x = prompt, y = subscale, fill = correlation)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(correlation, 3)), color = "black", size = 4) +
  scale_fill_gradient2(low = "#c44536",
                       mid = "#FFFFCC",
                       high = "dodgerblue") +
    geom_text(data = subset(autonomy_df, p_value < 0.05), aes(label = "*", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
    geom_text(data = subset(autonomy_df, p_value < 0.01), aes(label = "**", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
geom_text(data = subset(autonomy_df, p_value < 0.001), aes(label = "***", x = prompt, y = subscale, hjust = 1),
              color = "black", size = 4, vjust = -0.5) +
  plot_aes
```

# WordClouds {.tabset}

## Positive Affect {.tabset}

### Positive Affect 1 {.tabset}

#### Positive Affect 1 \~ Psychological Well-being

```{r fig.height=10, fig.width=10}
if (!file.exists("pos_affect1_WB_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 pos_affect1_WB_sub_SDP <- textProjection(
    words = df$Q1..positive_affect_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean)
 
 pos_affect1_WB_sub_SDP <- as.data.frame( pos_affect1_WB_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(pos_affect1_WB_sub_SDP, "pos_affect1_WB_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  pos_affect1_WB_sub_SDP <- readRDS("pos_affect1_WB_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- pos_affect1_WB_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

### Positive Affect 2 {.tabset}

#### Positive Affect 2 \~ Self-Acceptance

```{r fig.height=10, fig.width=10}
if (!file.exists("pos_affect2_acceptance_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 pos_affect2_acceptance_sub_SDP <- textProjection(
    words = df$Q2..positive_affect_2..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_self_acceptance)
 
 pos_affect2_acceptance_sub_SDP <- as.data.frame( pos_affect2_acceptance_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(pos_affect2_acceptance_sub_SDP, "pos_affect2_acceptance_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  pos_affect2_acceptance_sub_SDP <- readRDS("pos_affect2_acceptance_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- pos_affect2_acceptance_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Positive Affect 2 \~ Purpose in Life

```{r fig.height=10, fig.width=10}
if (!file.exists("pos_affect2_purpose_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 pos_affect2_purpose_sub_SDP <- textProjection(
    words = df$Q2..positive_affect_2..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_purpose)
 
 pos_affect2_purpose_sub_SDP <- as.data.frame( pos_affect2_purpose_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(pos_affect2_purpose_sub_SDP, "pos_affect2_purpose_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  pos_affect2_purpose_sub_SDP <- readRDS("pos_affect2_purpose_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- pos_affect2_purpose_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Positive Affect 2 \~ Satisfaction with Life

```{r fig.height=10, fig.width=10}
if (!file.exists("pos_affect2_SWLS_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 pos_affect2_SWLS_sub_SDP <- textProjection(
    words = df$Q2..positive_affect_2..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_SWLS_mean)
 
 pos_affect2_SWLS_sub_SDP <- as.data.frame( pos_affect2_SWLS_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(pos_affect2_SWLS_sub_SDP, "pos_affect2_SWLS_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  pos_affect2_SWLS_sub_SDP <- readRDS("pos_affect2_SWLS_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- pos_affect2_SWLS_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Positive Affect 2 \~ Environmental Mastery

```{r fig.height=10, fig.width=10}
if (!file.exists("pos_affect2_mastery_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 pos_affect2_mastery_sub_SDP <- textProjection(
    words = df$Q2..positive_affect_2..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_environmental_mastery)
 
 pos_affect2_mastery_sub_SDP <- as.data.frame( pos_affect2_mastery_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(pos_affect2_mastery_sub_SDP, "pos_affect2_mastery_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  pos_affect2_mastery_sub_SDP <- readRDS("pos_affect2_mastery_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- pos_affect2_mastery_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

## Autonomy {.tabset}

### Autonomy 1 {.tabset}

#### Autonomy 1 \~ Autonomy Subscale

```{r fig.height=10, fig.width=10}
if (!file.exists("auto1_autonomy_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto1_autonomy_sub_SDP <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy)
 
 auto1_autonomy_sub_SDP <- as.data.frame( auto1_autonomy_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto1_autonomy_sub_SDP, "auto1_autonomy_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto1_autonomy_sub_SDP <- readRDS("auto1_autonomy_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto1_autonomy_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 1 \~ Environmental Mastery

```{r fig.height=10, fig.width=10}
if (!file.exists("auto1_environment_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto1_environment_sub_SDP <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_environmental_mastery)
 
 auto1_environment_sub_SDP <- as.data.frame( auto1_environment_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto1_environment_sub_SDP, "auto1_environment_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto1_environment_sub_SDP <- readRDS("auto1_environment_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto1_environment_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )

ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 1 \~ Well-being

```{r fig.height=10, fig.width=10}
if (!file.exists("auto1_WB_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto1_WB_sub_SDP <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean)
 
 auto1_WB_sub_SDP <- as.data.frame( auto1_WB_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto1_WB_sub_SDP, "auto1_WB_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto1_WB_sub_SDP <- readRDS("auto1_WB_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto1_WB_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 1 \~ SWLS

```{r fig.height=10, fig.width=10}
if (!file.exists("auto1_SWLS_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto1_SWLS_sub_SDP <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean)
 
 auto1_SWLS_sub_SDP <- as.data.frame( auto1_SWLS_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto1_SWLS_sub_SDP, "auto1_SWLS_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto1_SWLS_sub_SDP <- readRDS("auto1_SWLS_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto1_SWLS_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

### Autonomy 3 {.tabset}

#### Autonomy 3 \~ Autonomy Subscale

```{r fig.height=10, fig.width=10}
if (!file.exists("auto3_autonomy_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto3_autonomy_sub_SDP <- textProjection(
    words = df$Q3..autonomy_3..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy)
 
 auto3_autonomy_sub_SDP <- as.data.frame( auto3_autonomy_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto3_autonomy_sub_SDP, "auto3_autonomy_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto3_autonomy_sub_SDP <- readRDS("auto3_autonomy_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto3_autonomy_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 3 \~ Environmental Mastery

```{r fig.height=10, fig.width=10}
if (!file.exists("auto3_environment_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto3_environment_sub_SDP <- textProjection(
    words = df$Q3..autonomy_3..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_environmental_mastery)
 
 auto3_environment_sub_SDP <- as.data.frame( auto3_environment_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto3_environment_sub_SDP, "auto3_environment_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto3_environment_sub_SDP <- readRDS("auto3_environment_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto3_environment_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 3 \~ PWB

```{r fig.height=10, fig.width=10}
if (!file.exists("auto3_PWB_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto3_PWB_sub_SDP <- textProjection(
    words = df$Q3..autonomy_3..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean)
 
 auto3_PWB_sub_SDP <- as.data.frame( auto3_PWB_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto3_PWB_sub_SDP, "auto3_PWB_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto3_PWB_sub_SDP <- readRDS("auto3_PWB_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto3_PWB_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )

ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

### Autonomy 4 {.tabset}

#### Autonomy 4 \~ Autonomy

```{r fig.height=10, fig.width=10}
if (!file.exists("auto4_autonomy_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto4_autonomy_sub_SDP <- textProjection(
    words = df$Q4..autonomy_4..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy)
 
 auto4_autonomy_sub_SDP <- as.data.frame(auto4_autonomy_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto4_autonomy_sub_SDP, "auto4_autonomy_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto4_autonomy_sub_SDP <- readRDS("auto4_autonomy_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 




filtered_df <- auto4_autonomy_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )

ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 4 \~ Environmental Mastery

```{r fig.height=10, fig.width=10}
if (!file.exists("auto4_environment_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto4_environment_sub_SDP <- textProjection(
    words = df$Q4..autonomy_4..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_environmental_mastery)
 
 auto4_environment_sub_SDP <- as.data.frame(auto4_environment_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto4_environment_sub_SDP, "auto4_environment_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto4_environment_sub_SDP <- readRDS("auto4_environment_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto4_environment_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```

#### Autonomy 4 \~ PWB

```{r fig.height=10, fig.width=10}
if (!file.exists("auto4_PWB_sub_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
 auto4_PWB_sub_SDP <- textProjection(
    words = df$Q4..autonomy_4..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean)
 
 auto4_PWB_sub_SDP <- as.data.frame(auto4_PWB_sub_SDP$word_data)


  # Save the results in an RDS file
  saveRDS(auto4_PWB_sub_SDP, "auto4_PWB_sub_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  auto4_PWB_sub_SDP <- readRDS("auto4_PWB_sub_SDP.RDS")
}


# Filter the DataFrame based on your criteria

#stat sig words with freq > 10 

filtered_df <- auto4_autonomy_sub_SDP %>%
  filter(
    n > 10 &
    p_values_dot.x < 0.1 &
    complete.cases(.) &
    !str_detect(words, paste(c("[.,?!]"), collapse = "|"))
  )


ggplot(filtered_df, aes(label = words, size = n, color = dot.x)) +
  geom_text_wordcloud(shape = "cardioid",show.legend = T,inherit.aes = T,rm_outside = TRUE) +
  scale_size_area(max_size = 40) + 
  guides(size = guide_legend(title = "Frequency"),
         color = guide_colorbar(title = "Predicted Score")) +
   scale_color_gradient(low = "#c44536", high = "dodgerblue") +
  plot_aes
```
