---
title: "LP2-Text-Prediction"
author: ""
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    df_print: paged
    highlight: tango
    theme: united
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
  github_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE)
options(scipen=999)
```

# load packages and installize conda environment

```{r, include=FALSE}
if (!require("pacman")) install.packages("pacman") #run this if you don't have pacman 
library(pacman)
setwd("~/Box Sync/CurrentProjects_Penn/LP2/within_person_intervention/data/models")

pacman::p_load(tidyverse,rlang, plotrix, ggpubr, caret, broom, kableExtra, reactable, knitr,install = T) 
# Set-up an environment with text-required python packages
```


```{r eval=FALSE, include=FALSE}
library(text)
textrpp_install()
textrpp_initialize()

```


# load data

```{r load-data}
df <- read_csv("/Users/stevenmesquiti/Box Sync/CurrentProjects_Penn/LP2/within_person_intervention/data/surveys_scored/LP2_transcriptions_behavioral.csv")
embeddings <- read_rds("/Users/stevenmesquiti/Box Sync/CurrentProjects_Penn/LP2/within_person_intervention/data/embeddings/all_embeddings.rds")
```

# define functions

```{r}
calculate_rmse <- function(data, actual_col, predicted_col) {
  # Calculate the differences between actual and predicted values
  differences <- data[[actual_col]] - data[[predicted_col]]

  # Square the differences
  squared_differences <- differences^2

  # Calculate the mean of squared differences
  mean_squared_error <- mean(squared_differences)

  # Calculate RMSE by taking the square root of the mean squared error
  rmse <- sqrt(mean_squared_error)

  return(rmse)
}


table <- function(correlation_data) {
  # Convert the character columns to factors for better rendering
  correlation_data$descriptions <- gsub("^Q[0-9]+\\.\\.(.+?)\\.\\.Transcription", "\\1", correlation_data$descriptions)
  correlation_data$descriptions <- gsub("(\\d)_([A-Za-z])", "\\1~\\2", correlation_data$descriptions)

  correlation_data$descriptions <- as.factor(correlation_data$descriptions)
  correlation_data$alternative <- as.factor(correlation_data$alternative)
  # Round the numeric columns to three decimal places
  correlation_data$correlation <- round(as.numeric(correlation_data$correlation), 3)
  correlation_data$t_statistics <- round(as.numeric(correlation_data$t_statistics), 3)
  correlation_data$p_value <- sapply(correlation_data$p_value, function(p) {
    ifelse(as.numeric(p) < 0.001, "< .001", 
           ifelse(as.numeric(p) == 1, "1.000", 
                  gsub("0.(.*)", ".\\1", sprintf("%.3f", as.numeric(p)))))
  })
  correlation_data$p_value_corrected <- round(as.numeric(correlation_data$p_value_corrected), 3)

  # Create the DataTable
  datatable(correlation_data, extensions = 'FixedColumns', 
            filter = list(position = 'top', clear = FALSE),
            options = list(search = list(regex = TRUE, caseInsensitive = FALSE), pageLength = 25))
}

```

# Breakdown of the Prompts {.tabset}

## Positive Affect

1.  Describe a recent time when you felt calm or at ease.

2.  Describe a recent time when you felt joyful or excited.

3.  Describe a recent time when you felt interested.

## Purpose

1.  When you think about your life, what are you striving to accomplish?

2.  What kind of plans do you have for the future and how are you working towards them?

3.  Do you feel like you have a sense of direction in your life, or do you feel like you're wandering aimlessly?

## Relationships

1.  Describe the level of trust between you and your friends.

2.  Describe a conversation you had recently with a family member or friends that you enjoyed.

3.  Describe a time when you were willing to generously share your time with someone else.

## Self-acceptance

1.  What aspect or aspects of your personality do you like?

2.  When you look back at the story of your life, what are you pleased about?

3.  What life achievements are you proud of?

## Personal Growth

1.  What experiences have you had that challenged how you think about yourself and the world?

2.  How have you developed as a person over time?

3.  Describe a situation that prompted you to change your old familiar ways of doing things.

## Autonomy

1.  In what ways do you judge yourself by what you think is important and/or what others think is important?

2.  In what ways do you worry about what other people think of you?

3.  In what ways are your decisions influenced (or not) by what others are doing?

4.  Describe a time when you chose to voice (or not voice) your own opinion on a controversial matter.

# construct models {.tabset}

## Positive Affect {.tabset}

### Satisfaction with Life

```{r}
if (!file.exists("affect_swls_output.RDS")) {
  affect_swls <- textTrainLists(
    x = embeddings$texts[7:9],
    y = df$pre_SWLS_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "positive affect predicting pre SWLS, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(affect_swls, "affect_swls_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  affect_swls <- readRDS("affect_swls_output.RDS")
}
table(affect_swls$results)

```

### Psychological Well-being

```{r}
if (!file.exists("affect_PWB_output.RDS")) {
  affect_PWB <- textTrainLists(
    x = embeddings$texts[7:9],
    y = df$pre_PWB_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "positive affect predicting pre PWB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(affect_PWB, "affect_PWB_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  affect_PWB <- readRDS("affect_PWB_output.RDS")
}
table(affect_PWB$results)
```


## Purpose {.tabset}

### Same Subscale

```{r}
if (!file.exists("purpose_output.RDS")) {
  purpose <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df$pre_PWB_autonomy,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "purpose predicting pre PWB purpose, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(purpose, "purpose_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  purpose <- readRDS("purpose_output.RDS")
}

table(purpose$results)

```

### Satisfaction with Life

```{r}
if (!file.exists("purpose_swls_output.RDS")) {
  purpose_swls <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df$pre_SWLS_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "purpose predicting pre SWLS, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(purpose_swls, "purpose_swls_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  purpose_swls <- readRDS("purpose_swls_output.RDS")
}

table(purpose_swls$results)

```

### Psychological Well-being

```{r}
if (!file.exists("purpose_PWB_output.RDS")) {
  purpose_PWB <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df$pre_PWB_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "purpose predicting pre PWB, N = 181"
  )
  
 
  
  # Save the model output to an RDS file
  saveRDS(purpose_PWB, "purpose_PWB_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  purpose_PWB <- readRDS("purpose_PWB_output.RDS")
}

table(purpose_PWB$results)
```

## Relationships {.tabset}

### Same Subscale

```{r}
if (!file.exists("relationships_output.RDS")) {
  relationships <- textTrainLists(
    x = embeddings$texts[13:15],
    y = df$pre_PWB_autonomy,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "relationships predicting pre PWB relationships, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(relationships, "relationships_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  relationships <- readRDS("relationships_output.RDS")
}

table(relationships$results)

```

### Satisfaction with Life

```{r}
if (!file.exists("relationships_SWLS_output.RDS")) {
  relationships_SWLS <- textTrainLists(
    x = embeddings$texts[13:15],
    y = df$pre_SWLS_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "relationships predicting pre SWLS, N = 181"
  )
  
  
  
  # Save the model output to an RDS file
  saveRDS(relationships_SWLS, "relationships_SWLS_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  relationships_SWLS <- readRDS("relationships_SWLS_output.RDS")
}


table(relationships_SWLS$results)

```

### Psychological Well-being

```{r}
if (!file.exists("relationships_PWB_output.RDS")) {
  relationships_PWB <- textTrainLists(
    x = embeddings$texts[13:15],
    y = df$pre_PWB_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "relationships predicting pre PWB, N = 181"
  )
  
  
  
  # Save the model output to an RDS file
  saveRDS(relationships_PWB, "relationships_PWB_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  relationships_PWB <- readRDS("relationships_PWB_output.RDS")
}

# Continue with your code using the "relationships_PWB" variable

table(relationships_PWB$results)

```

## Self-Acceptance {.tabset}

### Same Subscale

```{r}
if (!file.exists("acceptance_output.RDS")) {
  acceptance <- textTrainLists(
    x = embeddings$texts[16:18],
    y = df$pre_PWB_self_acceptance,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "self-acceptance growth predicting pre PWB self-acceptance, N = 181"
  )
  
 
  
  # Save the model output to an RDS file
  saveRDS(acceptance, "acceptance_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  acceptance <- readRDS("acceptance_output.RDS")
}

table(acceptance$results)

```

### Satisfaction with Life

```{r}
if (!file.exists("acceptance_SWLS_output.RDS")) {
  acceptance_SWLS <- textTrainLists(
    x = embeddings$texts[16:18],
    y = df$pre_SWLS_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "acceptance predicting pre SWLS, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(acceptance_SWLS, "acceptance_SWLS_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  acceptance_SWLS <- readRDS("acceptance_SWLS_output.RDS")
}

table(acceptance_SWLS$results)

```

### Psychological Well-being

```{r}
if (!file.exists("acceptance_PWB_output.RDS")) {
  acceptance_PWB <- textTrainLists(
    x = embeddings$texts[16:18],
    y = df$pre_PWB_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "acceptance predicting pre PWB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(acceptance_PWB, "acceptance_PWB_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  acceptance_PWB <- readRDS("acceptance_PWB_output.RDS")
}

table(acceptance_PWB$results)
```

## Personal Growth {.tabset}

### Same Subscale

```{r}
if (!file.exists("growth_output.RDS")) {
  growth <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df$pre_PWB_personal_growth,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "personal growth predicting pre PWB growth, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(growth, "growth_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  growth <- readRDS("growth_output.RDS")
}

table(growth$results)

```

### Satisfaction with Life

```{r}
if (!file.exists("growth_SWLS_output.RDS")) {
  growth_SWLS <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df$pre_SWLS_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "personal growth predicting pre SWLS, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(growth_SWLS, "growth_SWLS_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  growth_SWLS <- readRDS("growth_SWLS_output.RDS")
}

table(growth_SWLS$results)
```

### Psychological Well-being

```{r}
if (!file.exists("growth_PWB_output.RDS")) {
  growth_PWB <- textTrainLists(
    x = embeddings$texts[4:6],
    y = df$pre_PWB_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "personal growth predicting pre PWB, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(growth_PWB, "growth_PWB_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  growth_PWB <- readRDS("growth_PWB_output.RDS")
}

table(growth_PWB$results)
```


## Autonomy {.tabset}

### Same Subscale

```{r}
if (!file.exists("autonomy_output.RDS")) {
  autonomy <- textTrainLists(
    x = embeddings$texts[1:3],
    y = df$pre_PWB_autonomy,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "autonomy predicting pre PWB autonomy, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(autonomy, "autonomy_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  autonomy <- readRDS("autonomy_output.RDS")
}

table(autonomy$results)
```

### Satisfaction with Life

```{r}
if (!file.exists("autonomy_SWLS_output.RDS")) {
  autonomy_SWLS <- textTrainLists(
    x = embeddings$texts[1:3],
    y = df$pre_SWLS_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "autonomy predicting pre SWLS, N = 181"
  )
  
  
  
  # Save the model output to an RDS file
  saveRDS(autonomy_SWLS, "autonomy_SWLS_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  autonomy_SWLS <- readRDS("autonomy_SWLS_output.RDS")
}

table(autonomy_SWLS$results)
```

### Psychological Well-being

```{r}
if (!file.exists("autonomy_PWB_output.RDS")) {
  autonomy_PWB <- textTrainLists(
    x = embeddings$texts[1:3],
    y = df$pre_PWB_mean,
    force_train_method = "regression",
    save_output = "all",
    method_cor = "pearson",
    eval_measure = "rmse",
    p_adjust_method = "bonferroni",
    model_description = "autonomy predicting pre PWB autonomy, N = 181"
  )
  
  
  # Save the model output to an RDS file
  saveRDS(autonomy_PWB, "autonomy_PWB_output.RDS")
} else {
  # If the RDS file already exists, load the data from it
  autonomy_PWB <- readRDS("autonomy_PWB_output.RDS")
}

table(autonomy_PWB$results)

```

# Supervised Dimension Projection Plots {.tabset}

Only including the one's with meaningful effects for now (i.e., sig. corrected p-values) 

### Work around 

For the time-being please use this [link](https://docs.google.com/presentation/d/1YlUrDJbIUN-fau06OoheD-VQuPUTz6At5AjBtHfhq44/edit?usp=sharing) to access the complete plots


## Affect {.tabset}

### Psychological Well-being 

```{r fig.height=5, fig.width=7, message=FALSE}
 options(ggrepel.max.overlaps = 1000)


if (!file.exists("affect2_PWB_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q2..positive_affect_2..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy
  )

  # To avoid warnings, increase max.overlaps
 

  affect2_PWB <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Affect Q2 predicting PWB scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Psychological Well-being",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(affect2_PWB, "affect2_PWB_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  affect2_PWB <- readRDS("affect2_PWB_SDP.RDS")
}

affect2_PWB$final_plot

```

## Autonomy {.tabset}

### Autonomy Subscale {.tabset}

#### Autonomy 1

```{r fig.height=5, fig.width=7}
 options(ggrepel.max.overlaps = 1000)

if (!file.exists("autonomy1_autonomy_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy1_autonomy <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q1 predicting Autonomy Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Autonomy Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy1_autonomy, "autonomy1_autonomy_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy1_autonomy <- readRDS("autonomy1_autonomy_SDP.RDS")
}

autonomy1_autonomy$final_plot


```

#### Autonomy 3

```{r fig.height=5, fig.width=7, message=FALSE}

 options(ggrepel.max.overlaps = 1000)

if (!file.exists("autonomy3_autonomy_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q3..autonomy_3..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy3_autonomy <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q3 predicting Autonomy Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Autonomy Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy3_autonomy, "autonomy3_autonomy_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy3_autonomy <- readRDS("autonomy3_autonomy_SDP.RDS")
}

autonomy3_autonomy$final_plot

```

#### Autonomy 4

```{r fig.height=5, fig.width=7, message=FALSE}

 options(ggrepel.max.overlaps = 1000)

if (!file.exists("autonomy4_autonomy_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q4..autonomy_4..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_autonomy
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy4_autonomy <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q4 predicting Autonomy Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Autonomy Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy4_autonomy, "autonomy4_autonomy_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy4_autonomy <- readRDS("autonomy4_autonomy_SDP.RDS")
}

autonomy4_autonomy$final_plot

```


### Satisfaction with Life {.tabset}

#### Autonomy 1 

```{r fig.height=5, fig.width=7, message=FALSE}

 options(ggrepel.max.overlaps = 1000)

if (!file.exists("autonomy1_SWLS_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_SWLS_mean
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy1_SWLS <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q1 predicting SWLS Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Satisfaction with Life Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy1_SWLS, "autonomy1_SWLS_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy1_SWLS <- readRDS("autonomy1_SWLS_SDP.RDS")
}

autonomy1_SWLS$final_plot

```

### Psychological Well-being 

#### Autonomy 1

```{r fig.height=5, fig.width=7, message=FALSE}

 options(ggrepel.max.overlaps = 1000)

if (!file.exists("autonomy1_PWB_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q1..autonomy_1..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy1_PWB <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q1 predicting PWB Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Psychological Well-being Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy1_PWB, "autonomy1_PWB_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy1_PWB <- readRDS("autonomy1_PWB_SDP.RDS")
}

autonomy1_PWB$final_plot
```

#### Autonomy 3

```{r fig.height=5, fig.width=7, message=FALSE}
 options(ggrepel.max.overlaps = 1000)


if (!file.exists("autonomy3_PWB_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q3..autonomy_3..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy3_PWB <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q3 predicting PWB Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Psychological Well-being Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy3_PWB, "autonomy3_PWB_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy3_PWB <- readRDS("autonomy3_PWB_SDP.RDS")
}

autonomy3_PWB$final_plot

```

#### Autonomy 4

```{r fig.height=5, fig.width=7, message=FALSE}

 options(ggrepel.max.overlaps = 1000)

if (!file.exists("autonomy4_PWB_SDP.RDS")) {
  # If the file doesn't exist, perform the analysis
  projection_results <- textProjection(
    words = df$Q4..autonomy_4..Transcription,
    word_embeddings = embeddings$texts,
    word_types_embeddings = embeddings$word_types,
    x = df$pre_PWB_mean
  )

  # To avoid warnings, increase max.overlaps
  options(ggrepel.max.overlaps = 1000)

  autonomy4_PWB <- textProjectionPlot(
    word_data = projection_results,
    min_freq_words_plot = 1,
    plot_n_word_extreme = 10,
    plot_n_word_frequency = 1,
    plot_n_words_middle = 1,
    y_axes = FALSE,
    p_alpha = 0.05,
    p_adjust_method = "bonferroni",
    title_top = "Autonomy Q4 predicting PWB Scores (Supervised Dimension Projection)",
    x_axes_label = "pre-Psychological Well-being Scores",
    y_axes_label = "",
    bivariate_color_codes = c("#FFFFFF", "#FFFFFF", "#FFFFFF",
                              "#E07f6a", "#CBC3E3", "dodgerblue",
                              "#FFFFFF", "#FFFFFF", "#FFFFFF")
  )

  # Save the results in an RDS file
  saveRDS(autonomy4_PWB, "autonomy4_PWB_SDP.RDS")
} else {
  # If the file exists, load the results from the RDS file
  autonomy4_PWB <- readRDS("autonomy4_PWB_SDP.RDS")
}

autonomy4_PWB
```



